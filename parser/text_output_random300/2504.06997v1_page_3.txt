3 
To overcome the limitations of traditional fitting and leverage the capabilities of the new ATLAS 
SPAD sensor20, this paper presents the following innovations: 
We incorporated a SPAD-DCS system with a DL model trained on datasets generated by the two-
layer DCS analytical model for real-time CBFi estimation. We validated our method using 
simulated test datasets to assess CBFi waveform recovery, rCBFi estimation, and CBFi sensitivity 
to brain and scalp blood flow perturbations, comparing the results with the traditional single-
exponential fitting. Finally, we evaluated the capability of the DL-based DCS system to monitor 
brain activity during a â€˜lunch testâ€™ in a healthy adult at a large sourceâ€“detector separation (35 mm). 
 
2 
Methods 
2.1 Theory of the two-layer analytical model 
The DCS theory is based on the correlation diffusion equation (CDE), derived from correlation 
transfer equation (CTE) under the standard diffusion assumption6. This derivation is analogous to 
the photon diffusion equation (PDE) from the radiative transfer equation (RTE) using the ğ‘ƒğ‘ƒğ‘ğ‘ 
approximation6,31. The analogy between the CTE and RTE was firstly established by Ackerson et 
al.32. The CDE is expressed as: 
àµ¬ğ·ğ·
ğœğœâˆ‡2 âˆ’ğœ‡ğœ‡ğ‘ğ‘âˆ’1
3 ğœ‡ğœ‡ğ‘ ğ‘ 
â€²ğ‘˜ğ‘˜0
2ğ›¼ğ›¼âŒ©âˆ†ğ‘Ÿğ‘Ÿ2(ğœğœ)âŒªàµ°ğºğº1(ğ«ğ«, ğœğœ) = âˆ’ğ‘†ğ‘†(ğ«ğ«),
(1) 
where ğºğº1(ğ«ğ«, ğœğœ) = âŒ©ğ¸ğ¸(ğ‘Ÿğ‘Ÿ, ğ‘¡ğ‘¡)ğ¸ğ¸âˆ—(ğ‘Ÿğ‘Ÿ, ğ‘¡ğ‘¡+ ğœğœ)âŒª is the unnormalized electric field temporal ACF, ğ·ğ·=
ğœğœ/(3ğœ‡ğœ‡ğ‘ ğ‘ 
â€²) is the photon diffusion coefficient, ğœğœ is the speed of light in the medium, ğœğœ is the lag time, 
ğ‘˜ğ‘˜0 = 2ğœ‹ğœ‹ğ‘›ğ‘›0/ğœ†ğœ† is the wavenumber of light in the scattering medium at the wavelength ğœ†ğœ† and ğ‘›ğ‘›0 is 
the tissue refractive index, ğœ‡ğœ‡ğ‘ğ‘ is the absorption coefficient, ğœ‡ğœ‡ğ‘ ğ‘ 
â€² is the reduced scattering coefficient, 
ğ‘†ğ‘†(ğ‘Ÿğ‘Ÿ) is the source, and âŒ©âˆ†ğ‘Ÿğ‘Ÿ2(ğœğœ)âŒª is the mean square displacement of scatterers. For diffusive 
motions, âŒ©âˆ†ğ‘Ÿğ‘Ÿ2(ğœğœ)âŒª= 6ğ·ğ·ğ‘ğ‘ğœğœ, where ğ·ğ·ğ‘ğ‘ is the effective Brownian diffusion coefficient. In most 
practical applications, the Brownian motion model is accurate to describe the scatterersâ€™ 
motions23,33,34. The product ğ›¼ğ›¼ğ›¼ğ›¼ğ‘ğ‘ is defined as BFi4,7, where ğ›¼ğ›¼ is defined as the ratio of moving 
scatterers to total scatterers, often assumed to be 135. 
Following the analytical derivation process developed by Gagnon et al.10, we assume an isotropic 
source incident at depth ğ‘§ğ‘§0 = 1/àµ«ğœ‡ğœ‡ğ‘ğ‘,1 + ğœ‡ğœ‡ğ‘ ğ‘ ,1
â€² àµ¯, and scatters in each layer present independent 
Brownian diffusion motion. Then the CDE will be 
àµ£ğ·ğ·1âˆ‡2 âˆ’ğœ‡ğœ‡ğ‘ğ‘,1 âˆ’2ğœ‡ğœ‡ğ‘ ğ‘ ,1
â€² ğ‘˜ğ‘˜0
2ğ·ğ·ğ‘ğ‘,1ğœğœàµ§ğºğº1,1(ğ‘¥ğ‘¥, ğ‘¦ğ‘¦, ğ‘§ğ‘§, ğœğœ) = âˆ’ğ›¿ğ›¿(ğ‘¥ğ‘¥, ğ‘¦ğ‘¦, ğ‘§ğ‘§âˆ’ğ‘§ğ‘§0)     0 â‰¤ğ‘§ğ‘§â‰¤ğ‘™ğ‘™, 
àµ£ğ·ğ·2âˆ‡2 âˆ’ğœ‡ğœ‡ğ‘ğ‘,2 âˆ’2ğœ‡ğœ‡ğ‘ ğ‘ ,2
â€² ğ‘˜ğ‘˜0
2ğ·ğ·ğ‘ğ‘,2ğœğœàµ§ğºğº1,2(ğ‘¥ğ‘¥, ğ‘¦ğ‘¦, ğ‘§ğ‘§, ğœğœ) = 0      ğ‘™ğ‘™â‰¤ğ‘§ğ‘§,
(2) 
where ğ‘—ğ‘—= 1,2 refers to the layer indices, ğºğº1,ğ‘—ğ‘—, ğ·ğ·ğ‘—ğ‘—, ğœ‡ğœ‡ğ‘ğ‘,ğ‘—ğ‘—, ğœ‡ğœ‡ğ‘ ğ‘ ,ğ‘—ğ‘—
â€² , and ğ·ğ·ğ‘ğ‘,ğ‘—ğ‘— are the unnormalized electric 
field temporal ACF, diffusion coefficient, absorption coefficient, reduced scattering coefficient, 
and Brownian diffusion coefficient in Layer ğ‘—ğ‘—, respectively,  ğ‘™ğ‘™ is the thickness of Layer 1. The 
Fourier domain solution to Eq. (2) at the surface of Layer 1 is 
ğºğºà·¨1,1(ğ‘ ğ‘ , ğ‘§ğ‘§, ğœğœ) = sinh[ğ›¼ğ›¼1(ğ‘§ğ‘§ğ‘ğ‘+ ğ‘§ğ‘§0)]
ğ·ğ·1ğ›¼ğ›¼1
Ã— ğ·ğ·1ğ›¼ğ›¼1cosh[ğ›¼ğ›¼1(ğ‘™ğ‘™âˆ’ğ‘§ğ‘§)] + ğ·ğ·2ğ›¼ğ›¼2sinh[ğ›¼ğ›¼1(ğ‘™ğ‘™âˆ’ğ‘§ğ‘§)]
ğ·ğ·1ğ›¼ğ›¼1cosh[ğ›¼ğ›¼1(ğ‘™ğ‘™+ ğ‘§ğ‘§ğ‘ğ‘)] + ğ·ğ·2ğ›¼ğ›¼2sinh[ğ›¼ğ›¼1(ğ‘™ğ‘™+ ğ‘§ğ‘§ğ‘ğ‘)]
âˆ’sinh[ğ›¼ğ›¼1(ğ‘§ğ‘§0 âˆ’ğ‘§ğ‘§)]
ğ·ğ·1ğ›¼ğ›¼1
,
(3)
 
