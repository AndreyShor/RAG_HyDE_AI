3 
To overcome the limitations of traditional fitting and leverage the capabilities of the new ATLAS 
SPAD sensor20, this paper presents the following innovations: 
We incorporated a SPAD-DCS system with a DL model trained on datasets generated by the two-
layer DCS analytical model for real-time CBFi estimation. We validated our method using 
simulated test datasets to assess CBFi waveform recovery, rCBFi estimation, and CBFi sensitivity 
to brain and scalp blood flow perturbations, comparing the results with the traditional single-
exponential fitting. Finally, we evaluated the capability of the DL-based DCS system to monitor 
brain activity during a ‘lunch test’ in a healthy adult at a large source–detector separation (35 mm). 
 
2 
Methods 
2.1 Theory of the two-layer analytical model 
The DCS theory is based on the correlation diffusion equation (CDE), derived from correlation 
transfer equation (CTE) under the standard diffusion assumption6. This derivation is analogous to 
the photon diffusion equation (PDE) from the radiative transfer equation (RTE) using the 𝑃𝑃𝑁𝑁 
approximation6,31. The analogy between the CTE and RTE was firstly established by Ackerson et 
al.32. The CDE is expressed as: 
൬𝐷𝐷
𝜐𝜐∇2 −𝜇𝜇𝑎𝑎−1
3 𝜇𝜇𝑠𝑠
′𝑘𝑘0
2𝛼𝛼〈∆𝑟𝑟2(𝜏𝜏)〉൰𝐺𝐺1(𝐫𝐫, 𝜏𝜏) = −𝑆𝑆(𝐫𝐫),
(1) 
where 𝐺𝐺1(𝐫𝐫, 𝜏𝜏) = 〈𝐸𝐸(𝑟𝑟, 𝑡𝑡)𝐸𝐸∗(𝑟𝑟, 𝑡𝑡+ 𝜏𝜏)〉 is the unnormalized electric field temporal ACF, 𝐷𝐷=
𝜐𝜐/(3𝜇𝜇𝑠𝑠
′) is the photon diffusion coefficient, 𝜐𝜐 is the speed of light in the medium, 𝜏𝜏 is the lag time, 
𝑘𝑘0 = 2𝜋𝜋𝑛𝑛0/𝜆𝜆 is the wavenumber of light in the scattering medium at the wavelength 𝜆𝜆 and 𝑛𝑛0 is 
the tissue refractive index, 𝜇𝜇𝑎𝑎 is the absorption coefficient, 𝜇𝜇𝑠𝑠
′ is the reduced scattering coefficient, 
𝑆𝑆(𝑟𝑟) is the source, and 〈∆𝑟𝑟2(𝜏𝜏)〉 is the mean square displacement of scatterers. For diffusive 
motions, 〈∆𝑟𝑟2(𝜏𝜏)〉= 6𝐷𝐷𝑏𝑏𝜏𝜏, where 𝐷𝐷𝑏𝑏 is the effective Brownian diffusion coefficient. In most 
practical applications, the Brownian motion model is accurate to describe the scatterers’ 
motions23,33,34. The product 𝛼𝛼𝛼𝛼𝑏𝑏 is defined as BFi4,7, where 𝛼𝛼 is defined as the ratio of moving 
scatterers to total scatterers, often assumed to be 135. 
Following the analytical derivation process developed by Gagnon et al.10, we assume an isotropic 
source incident at depth 𝑧𝑧0 = 1/൫𝜇𝜇𝑎𝑎,1 + 𝜇𝜇𝑠𝑠,1
′ ൯, and scatters in each layer present independent 
Brownian diffusion motion. Then the CDE will be 
ൣ𝐷𝐷1∇2 −𝜇𝜇𝑎𝑎,1 −2𝜇𝜇𝑠𝑠,1
′ 𝑘𝑘0
2𝐷𝐷𝑏𝑏,1𝜏𝜏൧𝐺𝐺1,1(𝑥𝑥, 𝑦𝑦, 𝑧𝑧, 𝜏𝜏) = −𝛿𝛿(𝑥𝑥, 𝑦𝑦, 𝑧𝑧−𝑧𝑧0)     0 ≤𝑧𝑧≤𝑙𝑙, 
ൣ𝐷𝐷2∇2 −𝜇𝜇𝑎𝑎,2 −2𝜇𝜇𝑠𝑠,2
′ 𝑘𝑘0
2𝐷𝐷𝑏𝑏,2𝜏𝜏൧𝐺𝐺1,2(𝑥𝑥, 𝑦𝑦, 𝑧𝑧, 𝜏𝜏) = 0      𝑙𝑙≤𝑧𝑧,
(2) 
where 𝑗𝑗= 1,2 refers to the layer indices, 𝐺𝐺1,𝑗𝑗, 𝐷𝐷𝑗𝑗, 𝜇𝜇𝑎𝑎,𝑗𝑗, 𝜇𝜇𝑠𝑠,𝑗𝑗
′ , and 𝐷𝐷𝑏𝑏,𝑗𝑗 are the unnormalized electric 
field temporal ACF, diffusion coefficient, absorption coefficient, reduced scattering coefficient, 
and Brownian diffusion coefficient in Layer 𝑗𝑗, respectively,  𝑙𝑙 is the thickness of Layer 1. The 
Fourier domain solution to Eq. (2) at the surface of Layer 1 is 
𝐺𝐺෨1,1(𝑠𝑠, 𝑧𝑧, 𝜏𝜏) = sinh[𝛼𝛼1(𝑧𝑧𝑏𝑏+ 𝑧𝑧0)]
𝐷𝐷1𝛼𝛼1
× 𝐷𝐷1𝛼𝛼1cosh[𝛼𝛼1(𝑙𝑙−𝑧𝑧)] + 𝐷𝐷2𝛼𝛼2sinh[𝛼𝛼1(𝑙𝑙−𝑧𝑧)]
𝐷𝐷1𝛼𝛼1cosh[𝛼𝛼1(𝑙𝑙+ 𝑧𝑧𝑏𝑏)] + 𝐷𝐷2𝛼𝛼2sinh[𝛼𝛼1(𝑙𝑙+ 𝑧𝑧𝑏𝑏)]
−sinh[𝛼𝛼1(𝑧𝑧0 −𝑧𝑧)]
𝐷𝐷1𝛼𝛼1
,
(3)
 
